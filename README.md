# Data Analysis for the Manuscript *'Changes in the Canine Plasma Lipidome after Short- and Long-Term Excess Glucocorticoid Exposure'*

Published in: *Scientific Reports* **9**, Article number: 6015 (2019)  [doi: 10.1038/s41598-019-42190-1](https://doi.org/10.1038/s41598-019-42190-1)

Authors: *Nadja S. Sieber-Ruckstuhl, Bo Burla, Susanne Spoerel, Florence Schmid, Claudio Venzin, Amaury Cazenave-Gassiot, Anne K. Bendt, Federico Torta, Markus R. Wenk, Felicitas S. Boretti* (Affiliations: *University of Zurich, Switzerland, and National University of Singapore*)

This repository containes the R scripts used to process the lipidomics raw data, to perform the statistical analyses and to generate all figures and tables of the manuscript. The code for the statistical analyses and figures is provided as a R Notebook with a packrat libary to faciliate reprodubility of the data analysis. The original version of the codes and GitHub repository  used for the publication have also been archived to Zenodo [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.2581113.svg)](https://doi.org/10.5281/zenodo.2581113)

## Getting the Code
All R code and datasets are provided as an [RStudio](https://www.rstudio.com/products/RStudio) project. The easiest way to download and run this code is to clone this repository within RStudio. In RStudio, select "New Project" from the "File" menu, then choose "Version Control" followed by "Git". Add the URL of this GitHub repository (https://github.com/SLINGhub/Manuscript_Sieber-Ruckstuhl_Burla_2019.git) and choose a local name and path. Alternatively, you can also download the Github Repository and open the Rstudio project. 

## Setting up the Code
By default, the dependencies for this project are managed using [packrat](https://rstudio.github.io/packrat/) to improve reproducibility and facilitate installation of required packages. After cloning, the required packages can be automatically installed by typing following command in the console: 
```r
packrat::restore()
```
You may need to restart the R session to activate packrat. Please note that downloading and installation of the packages may take a while depending on your system and the local packrat library will use around ~500 MB of storage. 

Should you prefer to use your local R library instead, you can turn packrat off via following command: 
```r
packrat::off()
```
In this case please make sure that you have all required packages installed. The package [ComplexHeatmap](https://github.com/jokergoo/ComplexHeatmap) is required in Version 1.99 or higher, which could be obtained at the time of writing via: 
```r
library(devtools)
install_github("jokergoo/ComplexHeatmap")
```

## Directory Structure
* `analysis/` Contains the R Notebook and R scripts. The HTML report generated from the R Notebook (`Sieber-Ruckstuhl_Burla_2019_StatisticsFigures.Rmd`) is also saved in this folder. 
* `data/`
    * `raw/`  Contains the original dataset (`Sieber-Ruckstuhl_Burla_2019_RawData-Annot.xlsx`) with peak areas from MS analyses, clininical chemistry results and all annotations.
    * `processed/`  Contains a precomputed version of the processed dataset (`Ruckstuhl-Sieber_Burla_2019_LipidConc_uM_TableS1.csv`). 
* `output/`  Contains the figures as PDF and tables as CSV generated by the scipts in the R notebook
* `packrat/`  Contains local packages of the project and other packrat related files 

## Running the Analysis
* Open the R Notebook `Sieber-Ruckstuhl_Burla_2019_StatisticsFigures.Rmd` (in the `Analysis` folder)
* Run the first and second chunks (Init and LoadProcessData). This will call the R scripts in `ms_data_postprocessing.R` to load and process the mass spectrometry raw data, resulting in the file `Ruckstuhl_Burla_2019_LipidConc_uM.csv`. By default this CSV file is then imported and the data is prepared to be used in chunks that generate the figures.
* Run the all or selected subsequent chunks to generate figures. The figures are then shown within the Notebook and additionally stored as PDF files in the folder `output`

* To create a report, click "Knit" in the RStudio user interface, this will by default generate a HTML document.   

For the publication, figures were imported as PDF files into Adobe Illustrator to adjust arrangements, dimensions, line widths and annotations.

## Contact
* Code and Data Analysis:  *Bo Burla* (lsibjb@nus.edu.sg) or submit a Github Issue/Pull request 
* Manuscript:  *Federico Torta* (bchfdtt@nus.edu.sg) and *Felicitas Boretti* (fboretti@vetclinics.uzh.ch)
            

License
----
The code in this analysis is covered by the `MIT` license 

